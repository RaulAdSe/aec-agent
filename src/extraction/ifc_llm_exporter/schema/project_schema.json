{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "$id": "https://aec-compliance-agent/schemas/project.json",
  "title": "IFC LLM Project Schema",
  "description": "Schema for project.json containing project metadata, coordinate systems, and spatial hierarchy",
  "type": "object",
  "required": ["project", "units", "coordinate_system", "spatial_tree", "indices"],
  "properties": {
    "project": {
      "type": "object",
      "description": "Project metadata information",
      "properties": {
        "name": { "type": "string" },
        "phase": { "type": "string" },
        "description": { "type": "string" },
        "building_type": { "type": "string" },
        "total_area": { "type": "number", "minimum": 0 },
        "number_of_levels": { "type": "integer", "minimum": 1 },
        "created_date": { "type": "string", "format": "date-time" },
        "modified_date": { "type": "string", "format": "date-time" }
      }
    },
    "units": {
      "type": "object",
      "description": "Unit definitions used throughout the project",
      "required": ["length", "area", "volume", "angle"],
      "properties": {
        "length": { "type": "string", "enum": ["m", "mm", "cm", "ft", "in"] },
        "area": { "type": "string", "enum": ["m2", "mm2", "cm2", "ft2", "in2"] },
        "volume": { "type": "string", "enum": ["m3", "mm3", "cm3", "ft3", "in3"] },
        "angle": { "type": "string", "enum": ["deg", "rad"] }
      }
    },
    "coordinate_system": {
      "type": "object",
      "description": "Coordinate system and georeferencing information",
      "required": ["model_origin_note", "true_north_deg"],
      "properties": {
        "model_origin_note": { "type": "string" },
        "true_north_deg": { "type": "number", "minimum": -360, "maximum": 360 },
        "world": {
          "type": "object",
          "description": "World coordinate reference system",
          "properties": {
            "epsg": { "type": ["integer", "null"], "minimum": 1000 },
            "name": { "type": "string" },
            "origin_llh": {
              "type": ["object", "null"],
              "properties": {
                "lat": { "type": "number", "minimum": -90, "maximum": 90 },
                "lon": { "type": "number", "minimum": -180, "maximum": 180 },
                "elev_m": { "type": "number" }
              }
            },
            "to_world_transform": {
              "type": ["array", "null"],
              "items": { "type": "number" },
              "minItems": 16,
              "maxItems": 16,
              "description": "4x4 transformation matrix as 16 floats (row-major)"
            },
            "notes": { "type": "string" }
          }
        }
      }
    },
    "spatial_tree": {
      "type": "array",
      "description": "Hierarchical spatial structure of the project",
      "items": { "$ref": "#/definitions/spatial_node" }
    },
    "indices": {
      "type": "object",
      "description": "Element indices for efficient lookup",
      "required": ["by_class", "by_storey", "by_zone"],
      "properties": {
        "by_class": {
          "type": "object",
          "description": "Elements grouped by IFC class",
          "patternProperties": {
            "^Ifc": {
              "type": "array",
              "items": { "type": "string", "pattern": "^[0-9A-Za-z_$]{22}$" }
            }
          }
        },
        "by_storey": {
          "type": "object",
          "description": "Elements grouped by building storey",
          "additionalProperties": {
            "type": "array",
            "items": { "type": "string", "pattern": "^[0-9A-Za-z_$]{22}$" }
          }
        },
        "by_zone": {
          "type": "object",
          "description": "Elements grouped by zone",
          "additionalProperties": {
            "type": "array",
            "items": { "type": "string", "pattern": "^[0-9A-Za-z_$]{22}$" }
          }
        },
        "by_space": {
          "type": "object",
          "description": "Elements grouped by space",
          "additionalProperties": {
            "type": "array",
            "items": { "type": "string", "pattern": "^[0-9A-Za-z_$]{22}$" }
          }
        }
      }
    }
  },
  "definitions": {
    "spatial_node": {
      "type": "object",
      "description": "Node in the spatial hierarchy tree",
      "required": ["guid", "class", "name"],
      "properties": {
        "guid": { 
          "type": "string", 
          "pattern": "^[0-9A-Za-z_$]{22}$",
          "description": "IFC Global Unique Identifier" 
        },
        "class": { 
          "type": "string",
          "pattern": "^Ifc",
          "description": "IFC class name"
        },
        "name": { "type": "string" },
        "description": { "type": "string" },
        "elevation_m": { "type": "number" },
        "children": {
          "type": "array",
          "items": { "$ref": "#/definitions/spatial_node" }
        }
      }
    }
  }
}